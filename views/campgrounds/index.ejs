<% layout('layouts/boilerplate') %>
<!-- Extend the boilerplate layout -->

<!-- Div to display the map with clusters -->
<div id="cluster-map"></div>

<!-- Heading for all campgrounds -->
<h1>All Campgrounds</h1>

<!-- Link to add a new campground -->
<div>
  <a href="/campgrounds/new">Add Campground</a>
</div>

<!-- Loop through all campgrounds and display them in cards -->
<% for (let campground of campgrounds) { %>
<div class="card mb-3">
  <div class="row">
    <!-- Display the first image of the campground if available -->
    <div class="col-md-4">
      <% if (campground.images && campground.images.length > 0) { %>
      <img
        crossorigin="anonymous"
        class="img-fluid"
        alt="<%= campground.title %>"
        src="<%= campground.images[0].url %>"
      />
      <% } else { %>
      <!-- Fallback image if no images are available -->
      <img
        class="img-fluid"
        alt="No image available"
        src="https://res.cloudinary.com/dru71u48u/image/upload/v1717717093/YelpCamp/gy2z8wk02hatj4dw3th2.jpg"
      />
      <% } %>
    </div>

    <!-- Display campground details -->
    <div class="col-md-8">
      <div class="card-body">
        <!-- Title of the campground -->
        <h5 class="card-title"><%= campground.title %></h5>

        <!-- Description of the campground -->
        <p class="card-text"><%= campground.description %></p>

        <!-- Location of the campground -->
        <p class="card-text">
          <small class="text-muted"><%= campground.location %></small>
        </p>

        <!-- Link to view the campground details -->
        <a class="btn btn-primary" href="/campgrounds/<%= campground._id %>">
          View <%= campground.title %>
        </a>
      </div>
    </div>
  </div>
</div>
<% } %>

<script>
  // Get the Mapbox token from the environment variables
  const mapToken = "<%-process.env.MAPBOX_TOKEN%>";

  // Convert campgrounds to GeoJSON format for the map
  const campgrounds = { features: <%- JSON.stringify(campgrounds) %> }
</script>

<!-- Include the JavaScript file for handling the map clusters -->
<script src="/javascripts/clusterMap.js"></script>
